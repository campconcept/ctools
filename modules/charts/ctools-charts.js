var t,e={75:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function a(){a=function(){return e};var t,e={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",s=c.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var a=e&&e.prototype instanceof w?e:w,o=Object.create(a.prototype),c=new _(n||[]);return i(o,"_invoke",{value:j(t,r,c)}),o}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function w(){}function b(){}function x(){}var D={};d(D,l,(function(){return this}));var E=Object.getPrototypeOf,k=E&&E(E(F([])));k&&k!==r&&o.call(k,l)&&(D=k);var S=x.prototype=w.prototype=Object.create(D);function L(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(a,i,c,l){var u=p(t[a],t,i);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==n(d)&&o.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,c,l)}),(function(t){r("throw",t,c,l)})):e.resolve(d).then((function(t){s.value=t,c(s)}),(function(t){return r("throw",t,c,l)}))}l(u.arg)}var a;i(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}})}function j(e,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=C(c,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=p(e,r,n);if("normal"===u.type){if(a=n.done?y:g,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=y,n.method="throw",n.arg=u.arg)}}}function C(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=p(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[l];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function r(){for(;++a<e.length;)if(o.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:b,configurable:!0}),b.displayName=d(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,d(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(T.prototype),d(T.prototype,u,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new T(h(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),d(S,s,"Generator"),d(S,l,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function o(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function c(t){o(i,n,a,c,l,"next",t)}function l(t){o(i,n,a,c,l,"throw",t)}c(void 0)}))}}r.d(e,{Qm:()=>g,kC:()=>D,tZ:()=>b,wi:()=>x});var c,l="ctoolsHourlyData",u=1,s="hourlyReadings",d="ctoolsHourlyDataSyncVersion",h="1.0.0",p=1e4,f=!1;function g(){if(!f){f=!0;var t=indexedDB.open(l,u);t.onerror=function(t){console.error("Error opening IndexedDB:",t.target.error)},t.onupgradeneeded=function(t){console.log("Creating or upgrading hourly data database...");var e=t.target.result;if(e.objectStoreNames.contains(s)){var r=t.target.transaction.objectStore(s);r.indexNames.contains("zaehlerid_datum")||(r.createIndex("zaehlerid_datum",["zaehlerid","datum"],{unique:!1}),console.log("Added compound index for zaehlerid_datum"))}else{var n=e.createObjectStore(s,{keyPath:"dsid"});n.createIndex("zaehlerid","zaehlerid",{unique:!1}),n.createIndex("datum","datum",{unique:!1}),n.createIndex("zaehlerid_datum",["zaehlerid","datum"],{unique:!1})}},t.onsuccess=function(t){var e;c=t.target.result,console.log("Hourly data database opened successfully"),(e=localStorage.getItem(d))!==h&&(console.log("Updating sync version from ".concat(e||"none"," to ").concat(h)),localStorage.setItem(d,h)),v(),function(){setInterval((function(){v()}),3e5);var t=function(){var e=new Date,r=60*(60-e.getMinutes())*1e3-1e3*e.getSeconds()-e.getMilliseconds();setTimeout((function(){console.log("Hour changed, syncing hourly data..."),v(),t()}),r)};t()}()}}}function m(){return y.apply(this,arguments)}function y(){return(y=i(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){try{if(!c)return void e(new Error("Database not initialized"));var r=c.transaction([s],"readonly").objectStore(s),n=null,a=null,o=r.openCursor(null,"next");o.onsuccess=function(e){var o=e.target.result;if(o){n=o.value.dsid;var i=r.openCursor(null,"prev");i.onsuccess=function(e){var o=e.target.result;if(o){a=o.value.dsid;var i=new Date,c="".concat(i.getFullYear(),"-").concat(String(i.getMonth()+1).padStart(2,"0"),"-").concat(String(i.getDate()).padStart(2,"0"));if(null!==a){var l=r.index("datum").openCursor(IDBKeyRange.upperBound(c,!0),"prev");l.onsuccess=function(e){var r=e.target.result;r&&(a=r.value.dsid),t({oldestDsid:n,newestDsid:a})},l.onerror=function(e){console.error("Error getting yesterday's data:",e.target.error),t({oldestDsid:n,newestDsid:a})}}else t({oldestDsid:n,newestDsid:a})}else t({oldestDsid:n,newestDsid:a})},i.onerror=function(e){console.error("Error getting max dsid:",e.target.error),t({oldestDsid:n,newestDsid:null})}}else t({oldestDsid:null,newestDsid:null})},o.onerror=function(e){console.error("Error getting min dsid:",e.target.error),t({oldestDsid:null,newestDsid:null})}}catch(i){console.error("Error in getDataBoundaries:",i),e(i)}})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(){var r=i(a().mark((function r(n,o){var i,c,l,u,s,d,h,f,g;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.log("Starting hourly data sync... (".concat(e?"newer":"older"," records)")),r.next=4,m();case 4:i=r.sent,c=i.oldestDsid,l=i.newestDsid,t&&(c=null,l=null),u=e?"newestDsid":"oldestDsid",d={action:"hourlyData",limit:p},null!==(s=e?l:c)&&(d[u]=s),h=!1,f=0,g=a().mark((function t(){var r,o,i,c,l,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("index.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(d)});case 2:if((o=t.sent).ok){t.next=5;break}throw new Error("HTTP error: ".concat(o.status));case 5:return t.next=7,o.json();case 7:if(i=t.sent,c=i.data||[],h=(null===(r=i.meta)||void 0===r?void 0:r.has_more)||!1,console.log("Received ".concat(c.length," hourly readings from server. Has more: ").concat(h)),0!==c.length){t.next=14;break}return n(!0),t.abrupt("return",1);case 14:return t.next=16,w(c);case 16:f+=c.length,h&&(l=0,u=Number.MAX_SAFE_INTEGER,c.forEach((function(t){t[0]>l&&(l=t[0]),t[0]<u&&(u=t[0])})),d={action:"hourlyData",limit:p},e?d.newestDsid=l:d.oldestDsid=u);case 18:case"end":return t.stop()}}),t)}));case 15:return r.delegateYield(g(),"t0",16);case 16:if(!r.t0){r.next=18;break}return r.abrupt("break",19);case 18:if(h){r.next=15;break}case 19:if(console.log("Sync completed. Total records synchronized: ".concat(f)),!(f>0)){r.next=29;break}return r.prev=21,r.next=24,v(!1,!e);case 24:r.next=29;break;case 26:r.prev=26,r.t1=r.catch(21),console.warn("Error syncing ".concat(e?"older":"newer"," records:"),r.t1);case 29:n(!0),r.next=36;break;case 32:r.prev=32,r.t2=r.catch(0),console.error("Error in syncHourlyData:",r.t2),o(r.t2);case 36:case"end":return r.stop()}}),r,null,[[0,32],[21,26]])})));return function(t,e){return r.apply(this,arguments)}}())}function w(t){return new Promise((function(e,r){try{if(!c)return void r(new Error("Database not initialized"));var n=c.transaction([s],"readwrite"),a=n.objectStore(s);n.onerror=function(t){console.error("Transaction error:",t.target.error),r(t.target.error)},n.oncomplete=function(){e()},t.forEach((function(t){try{var e={dsid:Number(t[0]),zaehlerid:Number(t[1]),datum:String(t[2]),val_start:null!==t[3]?Number(t[3]):0,val_0:null!==t[4]?Number(t[4]):0,val_1:null!==t[5]?Number(t[5]):0,val_2:null!==t[6]?Number(t[6]):0,val_3:null!==t[7]?Number(t[7]):0,val_4:null!==t[8]?Number(t[8]):0,val_5:null!==t[9]?Number(t[9]):0,val_6:null!==t[10]?Number(t[10]):0,val_7:null!==t[11]?Number(t[11]):0,val_8:null!==t[12]?Number(t[12]):0,val_9:null!==t[13]?Number(t[13]):0,val_10:null!==t[14]?Number(t[14]):0,val_11:null!==t[15]?Number(t[15]):0,val_12:null!==t[16]?Number(t[16]):0,val_13:null!==t[17]?Number(t[17]):0,val_14:null!==t[18]?Number(t[18]):0,val_15:null!==t[19]?Number(t[19]):0,val_16:null!==t[20]?Number(t[20]):0,val_17:null!==t[21]?Number(t[21]):0,val_18:null!==t[22]?Number(t[22]):0,val_19:null!==t[23]?Number(t[23]):0,val_20:null!==t[24]?Number(t[24]):0,val_21:null!==t[25]?Number(t[25]):0,val_22:null!==t[26]?Number(t[26]):0,val_23:null!==t[27]?Number(t[27]):0,val_end:null!==t[28]?Number(t[28]):0,usage_day:null!==t[29]?Number(t[29]):0};a.put(e)}catch(r){console.error("Error processing row:",r,t)}}))}catch(o){console.error("Error in storeHourlyData:",o),r(o)}}))}function b(t,e){return new Promise((function(r,n){try{var a=function(){console.warn("Compound index not available, falling back to less efficient query method");var t=i.index("zaehlerid").getAll(o);t.onsuccess=function(t){var n=t.target.result,a=n.find((function(t){return t.datum===e}));console.log("Found ".concat(n.length," records with zaehlerid ").concat(o,", matching record for date ").concat(e,": ").concat(a?"yes":"no")),r(a||null)},t.onerror=function(t){console.error("Error querying hourly data:",t.target.error),n(t.target.error)}};if(!c)return void n(new Error("Database not initialized"));if(null==t)return void n(new Error("zaehlerid must be provided"));var o=Number(t);if(isNaN(o))return void n(new Error("Invalid zaehlerid: ".concat(t)));console.log("Looking up data for zaehlerid: ".concat(o,", date: ").concat(e));var i=c.transaction([s],"readonly").objectStore(s);if(i.indexNames.contains("zaehlerid_datum")){var l=i.index("zaehlerid_datum"),u=[o,e],d=l.get(u);d.onsuccess=function(t){var n=t.target.result;console.log("Direct compound index lookup for zaehlerid ".concat(o,", date ").concat(e,": ").concat(n?"found":"not found")),r(n||null)},d.onerror=function(t){console.error("Error querying hourly data with compound index:",t.target.error),a()}}else a()}catch(h){console.error("Error in getHourlyDataForCounter:",h),n(h)}}))}function x(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(n,a){try{var o=function(){if(null!==r&&"number"==typeof r){var a=u.index("zaehlerid").getAll(r);a.onsuccess=function(r){var a=(r.target.result||[]).filter((function(r){return r.datum>=t&&r.datum<=e}));n(a)},a.onerror=function(t){console.error("Error querying by zaehlerid:",t.target.error),i()}}else i()},i=function(){var o=u.index("datum"),i=IDBKeyRange.bound(t,e),c=o.getAll(i);c.onsuccess=function(t){var e=t.target.result||[],a=null!==r&&"number"==typeof r?e.filter((function(t){return t.zaehlerid===r})):e;n(a)},c.onerror=function(t){console.error("Error querying by date range:",t.target.error),a(t.target.error)}};if(!c)return void a(new Error("db_not_init"));if(!t||!e)return void a(new Error("supply_start_and_end_date"));if(!/^\d{4}-\d{2}-\d{2}$/.test(t)||!/^\d{4}-\d{2}-\d{2}$/.test(e))return void a(new Error("date_mismatch"));if(t>e){console.log("Swapping dates: startDate (".concat(t,") was after endDate (").concat(e,")"));var l=[e,t];t=l[0],e=l[1]}var u=c.transaction([s],"readonly").objectStore(s);if(null!==r&&"number"==typeof r)if(u.indexNames.contains("zaehlerid_datum")){var d=u.index("zaehlerid_datum"),h=[],p=[r,t],f=[r,e],g=IDBKeyRange.bound(p,f),m=d.openCursor(g);m.onsuccess=function(t){var e=t.target.result;e?(h.push(e.value),e.continue()):n(h)},m.onerror=function(t){console.error("Error using compound index:",t.target.error),o()}}else o();else o()}catch(y){console.error("Error in getHourlyDataForDateRange:",y),a(y)}}))}function D(t){return new Promise((function(e,r){try{if(!c)return void r(new Error("Database not initialized"));if(null==t)return void r(new Error("zaehlerid must be provided"));var n=Number(t);if(isNaN(n))return void r(new Error("Invalid zaehlerid: ".concat(t)));var a=c.transaction([s],"readonly").objectStore(s).index("zaehlerid").getAll(n);a.onsuccess=function(t){var r=t.target.result,n=new Set;r.forEach((function(t){t.datum&&n.add(t.datum)}));var a=Array.from(n).sort();e(a)},a.onerror=function(t){console.error("Error querying available dates:",t.target.error),r(t.target.error)}}catch(o){console.error("Error in getAvailableDatesForCounter:",o),r(o)}}))}},121:(t,e,r)=>{r.r(e),r.d(e,{formatDateFromPicker:()=>x,highlightAvailableDates:()=>D,initDatePicker:()=>b,initializeChartResources:()=>d,initializeDatepicker:()=>g,loadChartJs:()=>p,setupDatepickerLocalization:()=>w});var n=r(75),a=r(515);function o(){o=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",s=c.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new _(n||[]);return a(i,"_invoke",{value:j(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function w(){}function b(){}function x(){}var D={};d(D,l,(function(){return this}));var E=Object.getPrototypeOf,k=E&&E(E(F([])));k&&k!==r&&n.call(k,l)&&(D=k);var S=x.prototype=w.prototype=Object.create(D);function L(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(a,o,c,l){var u=p(t[a],t,o);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==i(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,c,l)}),(function(t){r("throw",t,c,l)})):e.resolve(d).then((function(t){s.value=t,c(s)}),(function(t){return r("throw",t,c,l)}))}l(u.arg)}var o;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}})}function j(e,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=C(c,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=p(e,r,n);if("normal"===u.type){if(a=n.done?y:g,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=y,n.method="throw",n.arg=u.arg)}}}function C(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=p(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[l];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(i(e)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=d(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,d(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(T.prototype),d(T.prototype,u,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new T(h(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),d(S,s,"Generator"),d(S,l,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function c(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}function l(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){c(o,n,a,i,l,"next",t)}function l(t){c(o,n,a,i,l,"throw",t)}i(void 0)}))}}var u=!1,s=!1;function d(){return h.apply(this,arguments)}function h(){return(h=l(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.warn("Beginning to initialize chart resources"),(0,a.C)(),(0,n.Qm)(),t.next=6,p();case 6:return e=t.sent,t.next=9,g();case 9:return r=t.sent,t.abrupt("return",e&&r);case 13:return t.prev=13,t.t0=t.catch(0),console.error("Failed to initialize chart resources:",t.t0),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=l(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s&&"undefined"==typeof Chart){t.next=3;break}return s=!0,t.abrupt("return",!0);case 3:return t.prev=3,t.next=6,y("https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js");case 6:if("undefined"!=typeof Chart){t.next=8;break}throw new Error("Chart.js loaded but Chart object not available");case 8:return s=!0,console.log("Chart.js loaded successfully"),t.abrupt("return",!0);case 13:return t.prev=13,t.t0=t.catch(3),console.error("Error loading Chart.js:",t.t0),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,null,[[3,13]])})))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=l(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u&&"undefined"==typeof tempusDominus){t.next=3;break}return"undefined"!=typeof tempusDominus&&(w(),u=!0),t.abrupt("return",u);case 3:return t.prev=3,v("https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/css/tempus-dominus.min.css"),t.next=7,y("https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/js/tempus-dominus.min.js");case 7:if("undefined"!=typeof tempusDominus){t.next=9;break}throw new Error("Tempus Dominus loaded but object not available");case 9:return w(),u=!0,console.warn("Datepicker initialized successfully"),t.abrupt("return",!0);case 15:return t.prev=15,t.t0=t.catch(3),console.error("Failed to initialize datepicker:",t.t0),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,null,[[3,15]])})))).apply(this,arguments)}function y(t){return new Promise((function(e,r){var n=document.createElement("script");n.src=t,n.async=!0,n.onload=function(){return e()},n.onerror=function(t){return r(t)},document.head.appendChild(n)}))}function v(t){var e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)}function w(){if("undefined"!=typeof tempusDominus){var t=window.getCurrentLanguage(),e=t.substring(0,2);try{tempusDominus.DefaultOptions.localization={locale:e,format:"yyyy-MM-dd",dayViewHeaderFormat:{month:"long",year:"numeric"}},tempusDominus.DefaultOptions.useCurrent=!1,tempusDominus.DefaultOptions.keepInvalid=!1;try{for(var r=[],n=new Intl.DateTimeFormat(t,{weekday:"short"}),a=0;a<7;a++){var o=new Date(2023,0,a+1);r.push(n.format(o))}for(var i=[],c=new Intl.DateTimeFormat(t,{month:"long"}),l=0;l<12;l++){var u=new Date(2023,l,1);i.push(c.format(u))}tempusDominus.DefaultOptions.localization.dayNames=r,tempusDominus.DefaultOptions.localization.monthNames=i;if(tempusDominus.DefaultOptions.localization.startOfTheWeek=["en-US","en-CA"].includes(t)?0:1,"function"==typeof window.getTranslatedText)try{tempusDominus.DefaultOptions.localization.today=window.getTranslatedText("general","today")||"Today"}catch(s){tempusDominus.DefaultOptions.localization.today="Today"}}catch(d){console.warn("Error setting up datepicker localization details:",d)}}catch(d){console.warn("Error in datepicker localization setup:",d)}}else console.warn("Tempus Dominus library not loaded, skipping datepicker localization")}function b(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{var o=function(){try{D(t,u)}catch(e){console.error("Error in datepicker highlight callback:",e)}};console.warn("Attempting to initialize datepicker: ".concat(t));var c,l=document.getElementById(t);if(!l)return console.error("Datepicker container #".concat(t," not found!")),null;if("undefined"==typeof tempusDominus||!tempusDominus.TempusDominus)return console.error("tempusDominus library not available!",{tempusDominus:"undefined"==typeof tempusDominus?"undefined":i(tempusDominus),TempusDominus:null!==(c=tempusDominus)&&void 0!==c&&c.TempusDominus?"exists":"undefined"}),null;var u=new Set(r),s=new Date;a||(a="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"),"-").concat(String(s.getDate()).padStart(2,"0")));var d=new tempusDominus.TempusDominus(l,{display:{inline:!0,components:{clock:!1},calendarWeeks:!1},restrictions:{minDate:n?new Date(n+"T00:00:00"):void 0,maxDate:a?new Date(a+"T23:59:59"):void 0},localization:{locale:window.getCurrentLanguage().substring(0,2),format:"L",dayViewHeaderFormat:{month:"long",year:"numeric"}},useCurrent:!1,defaultDate:e});if(!d)return console.error("Failed to create datepicker instance"),null;if(console.warn("Datepicker created successfully: ".concat(t),{pickerExists:!!d,subscribeMethod:i(d.subscribe),hasDisplay:!!d.display}),D(t,u),"function"==typeof d.subscribe)try{d.subscribe(tempusDominus.Namespace.events.update,o),d.subscribe(tempusDominus.Namespace.events.change,o),console.warn("Datepicker event subscriptions added successfully")}catch(h){console.error("Failed to subscribe to datepicker events:",h)}else console.error("datepicker.subscribe is not a function!",d);return d}catch(h){return console.error("Exception in initDatePicker:",h),null}}function x(t){if(!t.date)return null;var e=t.date.year,r=String(t.date.month+1).padStart(2,"0"),n=String(t.date.date).padStart(2,"0");return"".concat(e,"-").concat(r,"-").concat(n)}function D(t,e){var r=document.getElementById(t);r&&r.querySelectorAll(".date-container-days .day").forEach((function(t){if(t.classList.remove("highlighted"),!t.classList.contains("disabled")){var r=t.getAttribute("data-value");if(r){var n=r.split("T")[0];e.has(n)&&t.classList.add("highlighted")}}}))}},178:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Compteur: {0}",backToDailyView:"Retour \xe0 l'aper\xe7u quotidien",clickDayInstructions:"Cliquez sur un jour pour afficher les donn\xe9es horaires",hourlyConsumption:"Consommation Horaire (kWh)",dailyConsumption:"Consommation Journali\xe8re (kWh)",hourlyData:"Donn\xe9es Horaires: {0}",dailyData:"Consommation Journali\xe8re: {0}",date:"Date:",startDate:"Date de D\xe9but",endDate:"Date de Fin",consumption:"Consommation: {0}",noDataAvailable:"Aucune donn\xe9e disponible pour cette p\xe9riode.",close:"Fermer",day:"Jour",hour:"Heure",history:{title:"Historique: {0}",hourlyData:"Consommation Horaire (Aujourd'hui)",dailyData:"Consommation Journali\xe8re (7 Derniers Jours)"}},chartStats:{title:"Statistiques",total:"Consommation Totale",average:"Moyenne",median:"M\xe9diane",statistics:"Statistiques",averageLine:"Moyenne",medianLine:"M\xe9diane"},chartExport:{abortExport:"Annuler",processingMonth:"Traitement du mois: {current} / {total}",processingDay:"Traitement du jour: {current} / {total}",aborting:"Annulation en cours...",exportCancelled:"L'exportation PDF a \xe9t\xe9 annul\xe9e",hourlyConsumptionData:"Donn\xe9es de Consommation Horaire",dailyConsumptionData:"Donn\xe9es de Consommation Journali\xe8re",exportDropdown:"Exporter",exportingPDF:"G\xe9n\xe9ration du PDF en cours...",exportPDFWithDaily:"PDF avec valeurs horaires",exportExcelWithDaily:"Excel avec valeurs horaires",overviewSheet:"Vue d'ensemble",detailsSheet:"D\xe9tails Quotidiens",exportExcel:"Exporter vers Excel",exportPDF:"Exporter en PDF",hour:"Heure",date:"Date",consumption:"Consommation",counter:"Compteur",dataSheet:"Donn\xe9es de Consommation",errorExporting:"Erreur lors de l'exportation des donn\xe9es"},chartPDF:{pageNumbers:"Page {current} sur {total}"}}},240:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Contatore: {0}",backToDailyView:"Torna alla panoramica giornaliera",clickDayInstructions:"Clicca su un giorno per visualizzare i dati orari",hourlyConsumption:"Consumo Orario (kWh)",dailyConsumption:"Consumo Giornaliero (kWh)",hourlyData:"Dati Orari: {0}",dailyData:"Consumo Giornaliero: {0}",date:"Data:",startDate:"Data di Inizio",endDate:"Data di Fine",consumption:"Consumo: {0}",noDataAvailable:"Nessun dato disponibile per questo periodo.",close:"Chiudi",day:"Giorno",hour:"Ora",history:{title:"Cronologia: {0}",hourlyData:"Consumo Orario (Oggi)",dailyData:"Consumo Giornaliero (Ultimi 7 Giorni)"}},chartStats:{title:"Statistiche",total:"Consumo Totale",average:"Media",median:"Mediana",statistics:"Statistiche",averageLine:"Media",medianLine:"Mediana"},chartExport:{abortExport:"Interrompere",processingMonth:"Elaborazione mese: {current} / {total}",processingDay:"Elaborazione giorno: {current} / {total}",aborting:"Interruzione in corso...",exportCancelled:"L'esportazione PDF \xe8 stata annullata",hourlyConsumptionData:"Dati di Consumo Orario",dailyConsumptionData:"Dati di Consumo Giornaliero",exportDropdown:"Esporta",exportingPDF:"Generazione PDF in corso...",exportPDFWithDaily:"PDF con valori orari",exportExcelWithDaily:"Excel con valori orari",overviewSheet:"Panoramica",detailsSheet:"Dettagli Giornalieri",exportExcel:"Esporta Excel",exportPDF:"Esporta PDF",hour:"Ora",date:"Data",consumption:"Consumo",counter:"Contatore",dataSheet:"Dati di Consumo",errorExporting:"Errore durante l'esportazione dei dati"},chartPDF:{pageNumbers:"Pagina {current} di {total}"}}},290:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Contador: {0}",backToDailyView:"Volver a la vista diaria",clickDayInstructions:"Haga clic en un d\xeda para ver los datos por hora",hourlyConsumption:"Consumo Por Hora (kWh)",dailyConsumption:"Consumo Diario (kWh)",hourlyData:"Datos Por Hora: {0}",dailyData:"Consumo Diario: {0}",date:"Fecha:",startDate:"Fecha de Inicio",endDate:"Fecha de Fin",consumption:"Consumo: {0}",noDataAvailable:"No hay datos disponibles para este per\xedodo.",close:"Cerrar",day:"D\xeda",hour:"Hora",history:{title:"Historial: {0}",hourlyData:"Consumo Por Hora (Hoy)",dailyData:"Consumo Diario (\xdaltimos 7 D\xedas)"}},chartStats:{title:"Estad\xedsticas",total:"Consumo Total",average:"Promedio",median:"Mediana",statistics:"Estad\xedsticas",averageLine:"Promedio",medianLine:"Mediana"},chartExport:{abortExport:"Abortar",processingMonth:"Procesando mes: {current} / {total}",processingDay:"Procesando d\xeda: {current} / {total}",aborting:"Abortando...",exportCancelled:"La exportaci\xf3n PDF ha sido cancelada",hourlyConsumptionData:"Datos de Consumo por Hora",dailyConsumptionData:"Datos de Consumo Diario",exportDropdown:"Exportar",exportingPDF:"Generando PDF...",exportPDFWithDaily:"PDF con valores por hora",exportExcelWithDaily:"Excel con valores por hora",overviewSheet:"Resumen",detailsSheet:"Detalles Diarios",exportExcel:"Exportar Excel",exportPDF:"Exportar PDF",hour:"Hora",date:"Fecha",consumption:"Consumo",counter:"Contador",dataSheet:"Datos de Consumo",errorExporting:"Error al exportar datos"},chartPDF:{pageNumbers:"P\xe1gina {current} de {total}"}}},359:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"\u0160tevec: {0}",backToDailyView:"Nazaj na dnevni pregled",clickDayInstructions:"Kliknite na dan za ogled urnih podatkov",hourlyConsumption:"Urna Poraba (kWh)",dailyConsumption:"Dnevna Poraba (kWh)",hourlyData:"Urni Podatki: {0}",dailyData:"Dnevna Poraba: {0}",date:"Datum:",startDate:"Za\u010detni Datum",endDate:"Kon\u010dni Datum",consumption:"Poraba: {0}",noDataAvailable:"Za to obdobje ni na voljo podatkov.",close:"Zapri",day:"Dan",hour:"Ura",history:{title:"Zgodovina: {0}",hourlyData:"Urna Poraba (Danes)",dailyData:"Dnevna Poraba (Zadnjih 7 Dni)"}},chartStats:{title:"Statistika",total:"Skupna Poraba",average:"Povpre\u010dje",median:"Mediana",statistics:"Statistika",averageLine:"Povpre\u010dje",medianLine:"Mediana"},chartExport:{abortExport:"Prekini",processingMonth:"Obdelava meseca: {current} / {total}",processingDay:"Obdelava dneva: {current} / {total}",aborting:"Prekinjanje...",exportCancelled:"Izvoz PDF je bil preklican",hourlyConsumptionData:"Podatki o Urni Porabi",dailyConsumptionData:"Podatki o Dnevni Porabi",exportDropdown:"Izvoz",exportingPDF:"Ustvarjanje PDF-ja...",exportPDFWithDaily:"PDF z urnimi vrednostmi",exportExcelWithDaily:"Excel z urnimi vrednostmi",overviewSheet:"Pregled",detailsSheet:"Dnevni Podatki",exportExcel:"Izvoz Excel",exportPDF:"Izvoz PDF",hour:"Ura",date:"Datum",consumption:"Poraba",counter:"\u0160tevec",dataSheet:"Podatki o Porabi",errorExporting:"Napaka pri izvozu podatkov"},chartPDF:{pageNumbers:"Stran {current} od {total}"}}},405:(t,e,r)=>{var n={"./charts-lang-de-DE.js":456,"./charts-lang-en-US.js":559,"./charts-lang-es-ES.js":290,"./charts-lang-fr-FR.js":178,"./charts-lang-hr-HR.js":778,"./charts-lang-it-IT.js":240,"./charts-lang-nl-NL.js":846,"./charts-lang-sl-SI.js":359};function a(t){var e=o(t);return r(e)}function o(t){if(!r.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=o,t.exports=a,a.id=405},456:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Z\xe4hlerstand: {0}",backToDailyView:"Zur\xfcck zur Tages\xfcbersicht",clickDayInstructions:"Klicke auf einen Tag, um st\xfcndliche Daten anzuzeigen",hourlyConsumption:"St\xfcndlicher Verbrauch (kWh)",dailyConsumption:"T\xe4glicher Verbrauch (kWh)",hourlyData:"St\xfcndliche Daten: {0}",dailyData:"T\xe4glicher Verbrauch: {0}",date:"Datum:",startDate:"Startdatum",endDate:"Enddatum",consumption:"Verbrauch: {0}",noDataAvailable:"Keine Daten f\xfcr diesen Zeitraum verf\xfcgbar.",close:"Schlie\xdfen",day:"Tag",hour:"Stunde",history:{title:"Verlauf: {0}",hourlyData:"St\xfcndlicher Verbrauch (Heute)",dailyData:"T\xe4glicher Verbrauch (Letzte 7 Tage)"}},chartStats:{title:"Statistik",total:"Gesamtverbrauch",average:"Durchschnitt",median:"Median",statistics:"Statistiken",averageLine:"Durchschnitt",medianLine:"Median"},chartExport:{abortExport:"Abbrechen",processingMonth:"Verarbeitung Monat: {current} / {total}",processingDay:"Verarbeitung Tag: {current} / {total}",aborting:"Wird abgebrochen...",exportCancelled:"PDF-Export wurde abgebrochen",hourlyConsumptionData:"St\xfcndliche Verbrauchsdaten",dailyConsumptionData:"T\xe4gliche Verbrauchsdaten",exportDropdown:"Exportieren",exportingPDF:"PDF wird erstellt...",exportPDFWithDaily:"PDF mit Stundenwerten",exportExcelWithDaily:"Excel mit Stundenwerten",overviewSheet:"\xdcbersicht",detailsSheet:"Tagesdetails",exportExcel:"Excel exportieren",exportPDF:"PDF exportieren",hour:"Stunde",date:"Datum",consumption:"Verbrauch",counter:"Z\xe4hlerstand",dataSheet:"Verbrauchsdaten",errorExporting:"Fehler beim Exportieren der Daten"},chartPDF:{pageNumbers:"Seite {current} von {total}"}}},515:(t,e,r)=>{r.d(e,{j:()=>pt,C:()=>dt});var n=r(75);function a(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(t){if(!t||0===t.length)return{total:0,average:0,median:0};var e=t.filter((function(t){return null!=t&&!isNaN(t)}));if(0===e.length)return{total:0,average:0,median:0};var r,n=e.reduce((function(t,e){return t+e}),0),o=n/e.length,i=a(e).sort((function(t,e){return t-e}));if(i.length%2==0){var c=i.length/2;r=(i[c-1]+i[c])/2}else r=i[Math.floor(i.length/2)];return{total:n,average:o,median:r}}function c(t,e){return{averageLine:{type:"line",label:window.getTranslatedText("chartStats","averageLine"),data:Array(e).fill(t.average),borderColor:"rgba(255, 99, 132, 1)",borderWidth:1.5,borderDash:[5,5],pointRadius:0,fill:!1,tension:0}}}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"kWh";return{responsive:!0,maintainAspectRatio:!1,devicePixelRatio:window.devicePixelRatio,scales:{y:{beginAtZero:!0,title:{display:!0,text:t},grace:"5%",ticks:{callback:function(t){return window.formatNumber(t,"",window.getCurrentLanguage(),2)}}}},plugins:{tooltip:{callbacks:{label:function(t){var e=t.raw,r="";if(r=window.getTranslatedText("charts","consumption").replace("{0}",window.formatNumber(e," kWh",window.getCurrentLanguage(),2)),t.dataset&&t.dataset.counterValues&&void 0!==t.dataset.counterValues[t.dataIndex]){var n=t.dataset.counterValues[t.dataIndex];r=[r,window.getTranslatedText("charts","counterValue").replace("{0}",window.formatNumber(n," kWh",window.getCurrentLanguage(),2))]}return r}}},legend:{display:!0}}}}function u(t){t&&(t.innerHTML='\n        <div class="alert alert-info">\n            '.concat(window.getTranslatedText("charts","noDataAvailable"),"\n        </div>\n    "))}function s(t){var e=t.modalId,r=t.chartId,n=t.title,a=t.isHourly,o=t.hasParent,i=(t.minDate,t.maxDate,t.startDate),c=void 0===i?"":i,l=t.endDate,u=void 0===l?"":l,s=t.showClickInstructions,d=void 0!==s&&s?'<div class="text-end me-3 mt-1 small text-muted">\n             <i class="fa-solid fa-circle-info me-1"></i>'.concat(window.getTranslatedText("charts","clickDayInstructions"),"\n           </div>"):"",h=o?'<div class="text-center mt-3">\n             <button type="button" id="back-to-daily-btn" class="btn btn-outline-secondary" data-translation-key="charts.backToDailyView">\n                 <i class="fa-solid fa-arrow-left me-2"></i>'.concat(window.getTranslatedText("charts","backToDailyView"),"\n             </button>\n           </div>"):"",p=a?"":'<div class="row mb-3">\n             <div class="col-md-6">\n                 <label class="form-label text-center w-100">'.concat(window.getTranslatedText("charts","startDate"),'</label>\n                 <div id="').concat(e,'-start-datepicker" class="inline-calendar d-flex justify-content-center"></div>\n                 <input type="hidden" id="').concat(e,'-start-date" value="').concat(c,'">\n             </div>\n             <div class="col-md-6">\n                 <label class="form-label text-center w-100">').concat(window.getTranslatedText("charts","endDate"),'</label>\n                 <div id="').concat(e,'-end-datepicker" class="inline-calendar d-flex justify-content-center"></div>\n                 <input type="hidden" id="').concat(e,'-end-date" value="').concat(u,'">\n             </div>\n           </div>'),f='\n        <li><a class="dropdown-item" href="#" data-export-action="pdf" data-chart-id="'.concat(r,'" data-include-daily="false">\n            <i class="fa-solid fa-file-pdf me-2"></i>').concat(window.getTranslatedText("chartExport","exportPDF"),"\n        </a></li>\n        ").concat(a?"":'\n        <li><a class="dropdown-item" href="#" data-export-action="pdf-daily" data-chart-id="'.concat(r,'" data-include-daily="true">\n            <i class="fa-solid fa-file-pdf me-2"></i>').concat(window.getTranslatedText("chartExport","exportPDFWithDaily"),"\n        </a></li>\n        "),'\n        <li><hr class="dropdown-divider"></li>\n        <li><a class="dropdown-item" href="#" data-export-action="excel" data-chart-id="').concat(r,'" data-include-daily="false">\n            <i class="fa-solid fa-file-excel me-2"></i>').concat(window.getTranslatedText("chartExport","exportExcel"),"\n        </a></li>\n        ").concat(a?"":'\n        <li><a class="dropdown-item" href="#" data-export-action="excel-daily" data-chart-id="'.concat(r,'" data-include-daily="true">\n            <i class="fa-solid fa-file-excel me-2"></i>').concat(window.getTranslatedText("chartExport","exportExcelWithDaily"),"\n        </a></li>\n        "));return'\n    <div class="modal fade" id="'.concat(e,'" tabindex="-1" aria-labelledby="').concat(e,'-label" aria-hidden="true">\n        <div class="modal-dialog modal-dialog-centered modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title" id="').concat(e,'-label">').concat(n,'</h5>\n                    <div class="d-flex" style="padding: calc(var(--bs-modal-header-padding-y) * .5) calc(var(--bs-modal-header-padding-x) * .5); margin: calc(-.5 * var(--bs-modal-header-padding-y)) calc(-.5 * var(--bs-modal-header-padding-x)) calc(-.5 * var(--bs-modal-header-padding-y)) auto;">\n                        <div class="dropdown me-2">\n                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="').concat(e,'-export-dropdown" data-bs-toggle="dropdown" aria-expanded="false">\n                                <i class="fa-solid fa-file-export"></i> ').concat(window.getTranslatedText("chartExport","exportDropdown"),'\n                            </button>\n                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="').concat(e,'-export-dropdown">\n                                ').concat(f,'\n                            </ul>\n                        </div>\n                    </div>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="padding: calc(var(--bs-modal-header-padding-y) * .5) calc(var(--bs-modal-header-padding-x) * .5);margin: 0 !important;"></button>                    \n                </div>\n                <div class="modal-body">\n                    ').concat(p,'\n                    <div class="chart-container" style="position: relative; height: 400px; max-height: 500px; overflow: hidden;">\n                        <div id="').concat(r,'" style="width: 100%; height: 100%;"></div>\n                    </div>\n                    ').concat(d,"\n                    ").concat(h,"\n                </div>\n            </div>\n        </div>\n    </div>\n    ")}function d(t){if(!t)return{consumption:[],counterValues:[]};var e=[t.val_1||0,t.val_2||0,t.val_3||0,t.val_4||0,t.val_5||0,t.val_6||0,t.val_7||0,t.val_8||0,t.val_9||0,t.val_10||0,t.val_11||0,t.val_12||0,t.val_13||0,t.val_14||0,t.val_15||0,t.val_16||0,t.val_17||0,t.val_18||0,t.val_19||0,t.val_20||0,t.val_21||0,t.val_22||0,t.val_23||0,t.val_end||0],r=[],n=t.val_start||0,a=[];return e.forEach((function(t,o){if(0===t&&o>0&&0!==e[o-1])r.push(0),a.push(n);else{var i=Math.max(0,t-n);r.push(i),a.push(t),0!==t&&(n=t)}})),{consumption:r,counterValues:a}}function h(t){return t.map((function(t){var e=t.split("-");return"".concat(e[2],".").concat(e[1],".")}))}function p(t,e,r){return"hourly"===t?{label:window.getTranslatedText("charts","hourlyConsumption"),data:e,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,counterValues:r}:{label:window.getTranslatedText("charts","dailyConsumption"),data:e,backgroundColor:"rgba(75, 192, 192, 0.5)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1,counterValues:r}}function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function g(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(){m=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new _(n||[]);return a(i,"_invoke",{value:j(t,r,c)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var h="suspendedStart",p="suspendedYield",g="executing",y="completed",v={};function w(){}function b(){}function x(){}var D={};u(D,i,(function(){return this}));var E=Object.getPrototypeOf,k=E&&E(E(F([])));k&&k!==r&&n.call(k,i)&&(D=k);var S=x.prototype=w.prototype=Object.create(D);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(a,o,i,c){var l=d(t[a],t,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==f(s)&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(s).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}})}function j(e,r,n){var a=h;return function(o,i){if(a===g)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=C(c,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===h)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=g;var u=d(e,r,n);if("normal"===u.type){if(a=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=y,n.method="throw",n.arg=u.arg)}}}function C(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=d(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(f(e)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=u(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,u(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new T(s(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),u(S,l,"Generator"),u(S,i,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==e);l=!0);}catch(t){u=!0,a=t}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(t,e)||w(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=w(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function w(t,e){if(t){if("string"==typeof t)return b(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function x(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}function D(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){x(o,n,a,i,c,"next",t)}function c(t){x(o,n,a,i,c,"throw",t)}i(void 0)}))}}var E=!1,k=0;function S(t,e,r,n){return L.apply(this,arguments)}function L(){return L=D(m().mark((function t(e,r,n,a){var o,i,c,l,u,s,d,h,p,f,g,v,w,b,x,D,L,j,O,_,F,I,z,A,G,W,B,R,U,Y,q,Z,K,X,J,$,Q,tt,et,rt,nt,at,ot,it,ct,lt,ut,st,dt,ht,pt,ft,gt,mt=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=mt.length>4&&void 0!==mt[4]?mt[4]:"kWh",i=mt.length>5&&void 0!==mt[5]&&mt[5],t.prev=2,"undefined"!=typeof jspdf||"undefined"!=typeof jsPDF){t.next=7;break}return console.error("jsPDF library not found. Loading fallback..."),N((function(){setTimeout((function(){return S(e,r,n,a,o)}),1e3)})),t.abrupt("return");case 7:if(E=!1,k=0,(c=document.createElement("div")).style.position="fixed",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.backgroundColor="rgba(0,0,0,0.5)",c.style.display="flex",c.style.justifyContent="center",c.style.alignItems="center",c.style.zIndex="9999",c.innerHTML='\n            <div style="background: white; padding: 20px; border-radius: 5px; text-align: center; min-width: 300px;">\n                <div><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>\n                <div style="margin-top: 10px;">'.concat(window.getTranslatedText("chartExport","exportingPDF")||"Generating PDF...",'</div>\n                <div id="pdf-export-month-progress-container" style="margin-top: 15px; display: none;">\n                    <div class="progress" style="height: 10px;">\n                        <div id="pdf-export-month-progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" \n                            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\n                    </div>\n                    <div id="pdf-export-month-progress-text" style="margin-top: 5px; font-size: 0.8em;">\n                        <span id="pdf-export-month-current">0</span> / <span id="pdf-export-month-total">0</span>\n                    </div>\n                </div>\n                <div id="pdf-export-progress-container" style="margin-top: 15px; display: none;">\n                    <div class="progress" style="height: 10px;">\n                        <div id="pdf-export-progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" \n                            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\n                    </div>\n                    <div id="pdf-export-progress-text" style="margin-top: 5px; font-size: 0.8em;">\n                        <span id="pdf-export-progress-type"></span>: <span id="pdf-export-current">0</span> / <span id="pdf-export-total">0</span>\n                    </div>\n                </div>\n                <div style="margin-top: 15px;">\n                    <button id="pdf-export-abort-btn" class="btn btn-sm btn-outline-secondary">\n                        <i class="fa-solid fa-times me-1"></i>').concat(window.getTranslatedText("chartExport","abortExport")||"Abort","\n                    </button>\n                </div>\n            </div>\n        "),document.body.appendChild(c),(l=document.getElementById("pdf-export-abort-btn"))&&l.addEventListener("click",(function(){E=!0,l.disabled=!0,l.innerHTML='<i class="fa-solid fa-spinner fa-spin me-1"></i>'.concat(window.getTranslatedText("chartExport","aborting")||"Aborting...")})),u=function(t){"Escape"===t.key&&(E=!0,l&&(l.disabled=!0,l.innerHTML='<i class="fa-solid fa-spinner fa-spin me-1"></i>'.concat(window.getTranslatedText("chartExport","aborting")||"Aborting...")))},document.addEventListener("keydown",u),s="undefined"!=typeof jspdf?jspdf.jsPDF:jsPDF,d=e.data.labels||[],h=e.data.datasets||[],p=h.length>0?h[0]:{data:[]},f=p.data||[],g=p.counterValues||[],v=e.data.rawDates||[],w="hourly"===a,b=e.zaehlerid||null,x=window.decodeChannel(window.getChannelById(b)),D=x.beschreibung,L=0,j=new Set,O={},!w&&v&&v.length>0&&(L=v.length,v.forEach((function(t,e){var r=t.split("-"),n="".concat(r[0],"-").concat(r[1]);j.add(n),O[n]||(O[n]=[]),O[n].push({date:t,label:d[e],consumption:f[e]||0,counter:g[e]||0})}))),F=new s({orientation:_=L>14?"landscape":"portrait",compress:!0}),I=document.getElementById("sitename").innerHTML,F.setProperties({title:D,subject:window.getTranslatedText("chartExport","hourly"===a?"hourlyConsumptionData":"dailyConsumptionData"),author:I,creator:"CTOOLS.io",compress:!0}),z=F.internal.pageSize.getWidth(),A=F.internal.pageSize.getHeight(),G=15,!(j.size>1&&L>31)){t.next=81;break}H(0,W=Object.keys(O).length),B=0,R=Object.entries(O);case 52:if(!(B<R.length)){t.next=79;break}if(U=y(R[B],2),Y=U[0],q=U[1],H(++k,W),!E){t.next=59;break}return console.log("PDF export aborted by user during month processing"),t.abrupt("break",79);case 59:return Y!==Object.keys(O)[0]&&(F.addPage(_),G=15),Z=new Date(Y+"-01"),K=Z.toLocaleDateString(window.getCurrentLanguage(),{month:"long",year:"numeric"}),F.setFontSize(16),F.text("".concat(D," - ").concat(K),z/2,G,{align:"center"}),G+=10,t.next=67,T(F,q,G,z,_,o);case 67:if(G=t.sent,"function"==typeof F.autoTable?(X=q.map((function(t){return{label:t.label,consumption:window.formatNumber(t.consumption||0,"",window.getCurrentLanguage(),2),counter:window.formatNumber(t.counter||0,"",window.getCurrentLanguage(),2)}})),J=[{header:window.getTranslatedText("chartExport","date"),dataKey:"label"},{header:"".concat(window.getTranslatedText("chartExport","consumption")," (").concat(o,")"),dataKey:"consumption"},{header:"".concat(window.getTranslatedText("chartExport","counter")," (").concat(o,")"),dataKey:"counter"}],F.autoTable({startY:G,columns:J,body:X,margin:{left:20,right:20},theme:"grid",headStyles:{fillColor:[0,118,168],textColor:255},alternateRowStyles:{fillColor:[245,245,245]}})):F.text("Data table could not be generated - autoTable plugin not available",20,G),w||!i){t.next=76;break}if($=q.map((function(t){return t.date})),!E){t.next=74;break}return console.log("PDF export aborted by user during monthly detail pages"),t.abrupt("break",79);case 74:return t.next=76,P(F,$,D,o,b);case 76:B++,t.next=52;break;case 79:t.next=100;break;case 81:if("daily"===a?Q=M(d):e&&e.chartDate?(tt=new Date(e.chartDate),Q=tt.toLocaleDateString(window.getCurrentLanguage())):(console.warn("Chart date not available for hourly export"),Q=(new Date).toLocaleDateString(window.getCurrentLanguage())),F.setFontSize(16),F.text(D,z/2,G,{align:"center"}),G+=8,F.setFontSize(12),F.text("".concat("hourly"===a?window.getTranslatedText("charts","hourlyData").replace("{0}",""):window.getTranslatedText("charts","dailyData").replace("{0}","")," ").concat(Q),z/2,G,{align:"center"}),G+=10,et=e.canvas,rt=et.toDataURL("image/png",1),nt=et.width/et.height,"portrait"===_?ot=(at=z-40)/nt:(at=z-40,ot=Math.min(at/nt,110)),F.addImage(rt,"PNG",20,G,at,ot,"","FAST"),G+=ot+15,!w&&L>14&&(F.addPage(_),G=15,F.setFontSize(14),F.text("".concat(D," - ").concat(window.getTranslatedText("chartExport","detailsSheet")),z/2,G,{align:"center"}),G+=10),it=C(d,f,g,w,v),"function"==typeof F.autoTable?(ct=[{header:w?window.getTranslatedText("chartExport","hour"):window.getTranslatedText("chartExport","date"),dataKey:"label"},{header:"".concat(window.getTranslatedText("chartExport","consumption")," (").concat(o,")"),dataKey:"consumption"},{header:"".concat(window.getTranslatedText("chartExport","counter")," (").concat(o,")"),dataKey:"counter"}],F.autoTable({startY:G,columns:ct,body:it,margin:{left:20,right:20},theme:"grid",headStyles:{fillColor:[0,118,168],textColor:255},alternateRowStyles:{fillColor:[245,245,245]}}),G=F.previousAutoTable.finalY+10):(F.text("Data table could not be generated - autoTable plugin not available",20,G),G+=10,console.warn("autoTable plugin not available, trying to load it"),N()),w||!i){t.next=100;break}return t.next=100,P(F,v,D,o,b);case 100:for(lt=F.internal.getNumberOfPages(),ut=new Date,st=window.getCurrentLanguage(),dt=1;dt<=lt;dt++)F.setPage(dt),F.setFontSize(8),F.text(I,20,A-10,{align:"left"}),ht=ut.toLocaleDateString(st,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),pt=(pt=window.getTranslatedText("chartPDF","pageNumbers")).replace("{current}",dt).replace("{total}",lt),F.text("CTOOLS.io - ".concat(ht," - ").concat(pt),z-20,A-10,{align:"right"});ft=V(D,window.formatDate(new Date,"date"),"pdf"),F.save(ft),c&&(document.removeEventListener("keydown",u),document.body.removeChild(c)),t.next=114;break;case 109:t.prev=109,t.t0=t.catch(2),E?console.log("PDF export aborted by user"):(console.error("Error exporting to PDF:",t.t0),window.getTranslatedText("chartExport","errorExporting")),(gt=document.querySelector('div[style*="rgba(0,0,0,0.5)"]'))&&(document.removeEventListener("keydown",keyHandler),document.body.removeChild(gt));case 114:case"end":return t.stop()}}),t,null,[[2,109]])}))),L.apply(this,arguments)}function T(t,e,r,n,a){return j.apply(this,arguments)}function j(){return j=D(m().mark((function t(e,r,n,a,o){var c,l=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=l.length>5&&void 0!==l[5]?l[5]:"kWh",t.abrupt("return",new Promise((function(t,o){try{var l=r.map((function(t){return t.label})),u=r.map((function(t){return t.consumption})),s=r.map((function(t){return t.counter})),d=document.createElement("canvas");d.width=800,d.height=400,document.body.appendChild(d);var h={labels:l,datasets:[{label:window.getTranslatedText("charts","dailyConsumption"),data:u,backgroundColor:"rgba(75, 192, 192, 0.5)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1,counterValues:s}]},p=i(u),f=window.formatNumber(p.total," kWh",window.getCurrentLanguage(),2),g=window.formatNumber(p.average," kWh",window.getCurrentLanguage(),2),m=window.getTranslatedText("chartStats","total"),y=window.getTranslatedText("charts","day"),v="".concat(f," ").concat(m," - \xd8 ").concat(g," / ").concat(y);p.average>0&&h.datasets.push({type:"line",label:window.getTranslatedText("chartStats","averageLine"),data:Array(u.length).fill(p.average),borderColor:"rgba(255, 99, 132, 1)",borderWidth:1.5,borderDash:[5,5],pointRadius:0,fill:!1,tension:0});new Chart(d.getContext("2d"),{type:"bar",data:h,options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:c},ticks:{callback:function(t){return window.formatNumber(t,"",window.getCurrentLanguage(),2)}}}},plugins:{legend:{display:!0,position:"top"},title:{display:!0,position:"bottom",text:v}},animation:{duration:0}}});setTimeout((function(){try{var r,o,i=d.toDataURL("image/png");o=(r=a-40)*(d.height/d.width),e.addImage(i,"PNG",20,n,r,o),document.body.removeChild(d),t(n+o+10)}catch(c){console.error("Error converting chart to image:",c),e.setFontSize(10),e.text("Error generating monthly chart",20,n+10),document.body.contains(d)&&document.body.removeChild(d),t(n+20)}}),500)}catch(w){console.error("Error creating monthly chart:",w),e.setFontSize(10),e.text("Error generating monthly chart",20,n+10),t(n+20)}})));case 2:case"end":return t.stop()}}),t)}))),j.apply(this,arguments)}function C(t,e,r,n,a){var o=window.getCurrentLanguage(),i=[];return n?t.forEach((function(t,n){n<e.length&&i.push({label:t,consumption:window.formatNumber(e[n]||0,"",o,2),counter:window.formatNumber(r[n]||0,"",o,2)})})):t.forEach((function(t,n){if(n<e.length){var c=G(t,a?a[n]:null);i.push({label:c,consumption:window.formatNumber(e[n]||0,"",o,2),counter:window.formatNumber(r[n]||0,"",o,2)})}})),i}function P(t,e,r,n){return O.apply(this,arguments)}function O(){return O=D(m().mark((function t(e,r,n,a){var o,i,c,l,u,s,h,p,f,g,y,w=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=w.length>4&&void 0!==w[4]?w[4]:null){t.next=3;break}return t.abrupt("return");case 3:return i=document.getElementById("pdf-export-progress-container"),c=document.getElementById("pdf-export-progress-bar"),l=document.getElementById("pdf-export-current"),u=document.getElementById("pdf-export-total"),i&&c&&l&&u&&(i.style.display="block",u.textContent=r.length,l.textContent="0",c.style.width="0%",c.setAttribute("aria-valuenow","0")),s={},t.prev=9,t.next=12,z(r,n,o);case 12:s=t.sent,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(9),console.warn("Error pre-fetching hourly data for days:",t.t0);case 18:h=0,p=v(r),t.prev=20,g=m().mark((function t(){var o,i,c,l,u,p,g,y,v,w;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.value,!E){t.next=4;break}return console.log("PDF export aborted by user"),t.abrupt("return",0);case 4:if(i=s[o]){t.next=10;break}return console.warn("No hourly data available for ".concat(o)),W(++h,r.length),t.abrupt("return",1);case 10:return t.prev=10,e.addPage("portrait"),c=new Date(o).toLocaleDateString(window.getCurrentLanguage()),e.setFontSize(14),e.text("".concat(n," - ").concat(c),e.internal.pageSize.getWidth()/2,15,{align:"center"}),l=d(i),u=l.consumption,p=l.counterValues,g=["00 - 01","01 - 02","02 - 03","03 - 04","04 - 05","05 - 06","06 - 07","07 - 08","08 - 09","09 - 10","10 - 11","11 - 12","12 - 13","13 - 14","14 - 15","15 - 16","16 - 17","17 - 18","18 - 19","19 - 20","20 - 21","21 - 22","22 - 23","23 - 24"],t.next=19,_(e,i,25,e.internal.pageSize.getWidth(),a);case 19:y=t.sent,v=g.map((function(t,e){return{label:t,consumption:window.formatNumber(u[e]||"0","",window.getCurrentLanguage(),2),counter:u[e]&&p[e]?window.formatNumber(p[e],"",window.getCurrentLanguage(),2):""}})),w=[{header:window.getTranslatedText("chartExport","hour"),dataKey:"label"},{header:"".concat(window.getTranslatedText("chartExport","consumption")," (").concat(a,")"),dataKey:"consumption"},{header:"".concat(window.getTranslatedText("chartExport","counter")," (").concat(a,")"),dataKey:"counter"}],"function"==typeof e.autoTable?e.autoTable({startY:y+10,columns:w,body:v,margin:{left:20,right:20},theme:"grid",headStyles:{fillColor:[0,118,168],textColor:255},alternateRowStyles:{fillColor:[245,245,245]}}):e.text("Hourly data table could not be generated",20,50),W(++h,r.length),t.next=33;break;case 27:return t.prev=27,t.t0=t.catch(10),console.warn("Error processing hourly data for ".concat(o,":"),t.t0),W(++h,r.length),t.abrupt("return",1);case 33:case"end":return t.stop()}}),t,null,[[10,27]])})),p.s();case 23:if((f=p.n()).done){t.next=32;break}return t.delegateYield(g(),"t1",25);case 25:if(0!==(y=t.t1)){t.next=28;break}return t.abrupt("break",32);case 28:if(1!==y){t.next=30;break}return t.abrupt("continue",30);case 30:t.next=23;break;case 32:t.next=37;break;case 34:t.prev=34,t.t2=t.catch(20),p.e(t.t2);case 37:return t.prev=37,p.f(),t.finish(37);case 40:case"end":return t.stop()}}),t,null,[[9,15],[20,34,37,40]])}))),O.apply(this,arguments)}function _(t,e,r,n){return F.apply(this,arguments)}function F(){return F=D(m().mark((function t(e,r,n,a){var o,c=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=c.length>4&&void 0!==c[4]?c[4]:"kWh",t.abrupt("return",new Promise((function(t,c){try{var l=d(r),u=l.consumption,s=l.counterValues,h=["00 - 01","01 - 02","02 - 03","03 - 04","04 - 05","05 - 06","06 - 07","07 - 08","08 - 09","09 - 10","10 - 11","11 - 12","12 - 13","13 - 14","14 - 15","15 - 16","16 - 17","17 - 18","18 - 19","19 - 20","20 - 21","21 - 22","22 - 23","23 - 24"],p=document.createElement("canvas");p.width=800,p.height=400,document.body.appendChild(p);var f={labels:h,datasets:[{label:window.getTranslatedText("charts","hourlyConsumption"),data:u,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,counterValues:s}]},g=i(u),m=window.formatNumber(g.total," kWh",window.getCurrentLanguage(),2),y=window.formatNumber(g.average," kWh",window.getCurrentLanguage(),2),v=window.getTranslatedText("chartStats","total"),w=window.getTranslatedText("charts","hour"),b="".concat(m," ").concat(v," - \xd8 ").concat(y," / ").concat(w);g.average>0&&f.datasets.push({type:"line",label:window.getTranslatedText("chartStats","averageLine"),data:Array(u.length).fill(g.average),borderColor:"rgba(255, 99, 132, 1)",borderWidth:1.5,borderDash:[5,5],pointRadius:0,fill:!1,tension:0});new Chart(p.getContext("2d"),{type:"bar",data:f,options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:o},ticks:{font:{size:44},callback:function(t){return window.formatNumber(t,"",window.getCurrentLanguage(),2)}}},x:{ticks:{font:{size:44}}}},plugins:{legend:{display:!0,position:"top",labels:{font:{size:44}}},title:{display:!0,position:"bottom",text:b,font:{size:44}}},animation:{duration:0}}});setTimeout((function(){try{var r=p.toDataURL("image/png"),o=a-40,i=o*(p.height/p.width);e.addImage(r,"PNG",20,n,o,i,"","FAST"),document.body.removeChild(p),t(n+i+10+25)}catch(c){console.error("Error converting chart to image:",c),e.setFontSize(10),e.text("Error generating hourly chart",20,n+10),document.body.contains(p)&&document.body.removeChild(p),t(n+20)}}),500)}catch(x){console.error("Error creating hourly chart:",x),e.setFontSize(10),e.text("Error generating hourly chart",20,n+10),t(n+20)}})));case 2:case"end":return t.stop()}}),t)}))),F.apply(this,arguments)}function N(t){var e=0,r=function(){++e>=2&&"function"==typeof t&&t()};if(void 0===window.jspdf&&void 0===window.jsPDF){var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",n.onload=r,document.head.appendChild(n)}else r();var a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js",a.onload=r,document.head.appendChild(a)}function I(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"kWh",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;try{var i,c=t.labels||[],l=t.datasets||[],u=l.length>0?l[0]:{data:[]},s=u.data||[],h=u.counterValues||[],p=window.getCurrentLanguage(),f=window.decodeChannel(window.getChannelById(o.zaehlerid)),g=f&&f.beschreibung||"";if("daily"===r)i=M(c,t.rawDates);else if(o&&o.chartDate){var m=new Date(o.chartDate);i=m.toLocaleDateString(window.getCurrentLanguage())}else console.warn("Chart date not available for hourly export"),i=(new Date).toLocaleDateString(window.getCurrentLanguage());var y=XLSX.utils.book_new(),v=[];if(v.push(["".concat(g," - ").concat("hourly"===r?window.getTranslatedText("charts","hourlyData").replace("{0}",""):window.getTranslatedText("charts","dailyData").replace("{0}",""))]),v.push(["".concat(i)]),v.push([]),"hourly"===r)v.push([window.getTranslatedText("chartExport","hour"),"".concat(window.getTranslatedText("chartExport","consumption")," (").concat(n,")"),"".concat(window.getTranslatedText("chartExport","counter")," (").concat(n,")")]),c.forEach((function(t,e){e<s.length&&v.push([t,window.formatNumber(s[e]||0,"",window.getCurrentLanguage(),3),window.formatNumber(h[e]||0,"",window.getCurrentLanguage(),3)])}));else{v.push([window.getTranslatedText("chartExport","date"),"".concat(window.getTranslatedText("chartExport","consumption")," (").concat(n,")"),"".concat(window.getTranslatedText("chartExport","counter")," (").concat(n,")")]);var w=t.rawDates||[];c.forEach((function(t,e){if(e<s.length){var r,n=w[e]||null;if(n)r=new Date(n).toLocaleDateString(p,{year:"numeric",month:"2-digit",day:"2-digit"});else r=G(t,null);v.push([r,window.formatNumber(s[e]||0,"",p,3),window.formatNumber(h[e]||0,"",p,3)])}}))}v.push([]),v.push([window.getTranslatedText("chartStats","statistics")]),v.push(["".concat(window.getTranslatedText("chartStats","total")," (").concat(n,")"),window.formatNumber(e.total||0,"",p,3)]),v.push(["".concat(window.getTranslatedText("chartStats","average")," (").concat(n,")"),window.formatNumber(e.average||0,"",p,3)]);var b=XLSX.utils.aoa_to_sheet(v);if(b["!cols"]=[{wch:18},{wch:18},{wch:18}],XLSX.utils.book_append_sheet(y,b,window.getTranslatedText("chartExport","overviewSheet")),"daily"===r&&t.rawDates&&t.rawDates.length>0&&a)return console.log("Exporting hourly details for ".concat(t.rawDates.length," days")),void z(t.rawDates,g,o.zaehlerid).then((function(t){console.log("Received hourly data for ".concat(Object.keys(t).length," days")),function(t,e,r){if(0===Object.keys(e).length)return void console.warn("No hourly data available for details worksheet");console.log("Creating hourly details worksheet with data for ".concat(Object.keys(e).length," dates"));var n=[];n.push(["".concat(r," - ").concat(window.getTranslatedText("chartExport","detailsSheet"))]),n.push([]);var a=Object.keys(e).sort();console.log("Processing data for dates: ".concat(a.join(", ")));var o=[window.getTranslatedText("chartExport","hour")];a.forEach((function(t){var e=G("",t);o.push(e)})),n.push(o),["00 - 01","01 - 02","02 - 03","03 - 04","04 - 05","05 - 06","06 - 07","07 - 08","08 - 09","09 - 10","10 - 11","11 - 12","12 - 13","13 - 14","14 - 15","15 - 16","16 - 17","17 - 18","18 - 19","19 - 20","20 - 21","21 - 22","22 - 23","23 - 24"].forEach((function(t,r){var o=[t];if(a.length>0&&0===r){var i=a[0],c=e[i];console.log("Sample data for ".concat(i,":"),c)}a.forEach((function(t){var n=e[t],a=null;if(n)try{var i;(i=d(n))&&i.consumption&&void 0!==i.consumption[r]&&(a=i.consumption[r])}catch(l){console.error("Error calculating consumption for ".concat(t,", hour ").concat(r,":"),l)}if(null!=a){var c="function"==typeof window.formatNumber?window.formatNumber(a,"",window.getCurrentLanguage(),2):a.toFixed(2);o.push(c)}else o.push("")})),n.push(o)}));for(var i=XLSX.utils.aoa_to_sheet(n),c=[{wch:15}],l=0;l<a.length;l++)c.push({wch:15});i["!cols"]=c,XLSX.utils.book_append_sheet(t,i,window.getTranslatedText("chartExport","detailsSheet")),console.log("Hourly details worksheet created successfully")}(y,t,g);var e=V(g,i,"xlsx");XLSX.writeFile(y,e)})).catch((function(t){console.error("Error fetching hourly data:",t),"".concat(window.getTranslatedText("chartExport","errorExporting")," (details): ").concat(t.message);var e=V(g,i,"xlsx");XLSX.writeFile(y,e)}));new Date;var x=V(g,i,"xlsx");XLSX.writeFile(y,x)}catch(D){console.error("Error exporting to Excel:",D),window.getTranslatedText("chartExport","errorExporting")}}function z(t,e){return A.apply(this,arguments)}function A(){return A=D(m().mark((function t(e,r){var a,o,i,c,l,u,s,d,h,p,f,y=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=y.length>2&&void 0!==y[2]?y[2]:null){t.next=3;break}throw new Error("Could not determine channel ID from name");case 3:if(o={},e&&0!==e.length){t.next=6;break}return t.abrupt("return",o);case 6:return t.prev=6,i=g(e).sort(),c=i[0],l=i[i.length-1],console.log("Fetching hourly data for date range ".concat(c," to ").concat(l," for channel ").concat(a)),t.next=13,(0,n.wi)(c,l,a);case 13:u=t.sent,console.log("Retrieved ".concat(u.length," hourly data records")),u.length>0&&console.log("Sample data structure:",u[0]),s=v(u);try{for(s.s();!(d=s.n()).done;)(h=d.value).datum&&e.includes(h.datum)&&(o[h.datum]=h)}catch(r){s.e(r)}finally{s.f()}if(p=Object.keys(o),console.log("Found hourly data for ".concat(p.length," of ").concat(e.length," requested dates")),!((f=e.filter((function(t){return!o[t]}))).length>0)){t.next=25;break}return console.log("Fetching ".concat(f.length," missing dates individually"),f),t.next=25,Promise.all(f.map(function(){var t=D(m().mark((function t(e){var r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,n.tZ)(a,e);case 3:(r=t.sent)?(o[e]=r,console.log("Successfully retrieved data for ".concat(e))):console.log("No data found for ".concat(e)),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.warn("Could not fetch individual hourly data for ".concat(e,":"),t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()));case 25:t.next=32;break;case 27:return t.prev=27,t.t0=t.catch(6),console.error("Error in batch fetching hourly data:",t.t0),t.next=32,Promise.all(e.map(function(){var t=D(m().mark((function t(e){var r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,n.tZ)(a,e);case 3:(r=t.sent)&&(o[e]=r),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.warn("Could not fetch hourly data for ".concat(e,":"),t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()));case 32:return console.log("Total dates with hourly data: ".concat(Object.keys(o).length)),t.abrupt("return",o);case 34:case"end":return t.stop()}}),t,null,[[6,27]])}))),A.apply(this,arguments)}function M(t){if(!t||0===t.length)return window.formatDate(new Date,"date");if(1===t.length)return G(t[0]);var e=G(t[0]),r=G(t[t.length-1]);return"".concat(e," - ").concat(r)}function G(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&e.match(/^\d{4}-\d{2}-\d{2}$/)){var r=e.split("-"),n=r[0],a=r[1],o=r[2],i=window.getCurrentLanguage();return new Date(n,a-1,o).toLocaleDateString(i)}var c=t.match(/(\d{1,2})\.(\d{1,2})\.?/);if(c&&c.length>=3){var l=parseInt(c[1],10),u=parseInt(c[2],10)-1,s=(new Date).getFullYear(),d=window.getCurrentLanguage();return new Date(s,u,l).toLocaleDateString(d)}return t}function V(t,e,r){t||(t="channel_data"),e||(e=window.formatDate(new Date,"date")),r||(r="txt");var n=[t,e].map((function(t){return t.replace(/[\\/:*?"<>|]+/g,"_").replace(/\s+/g,"_")})).join("_"),a=r.replace(/^\./,"");return"".concat(n,".").concat(a)}function W(t,e){var r=document.getElementById("pdf-export-progress-container"),n=document.getElementById("pdf-export-progress-bar"),a=document.getElementById("pdf-export-current"),o=document.getElementById("pdf-export-total"),i=document.getElementById("pdf-export-progress-text"),c=document.getElementById("pdf-export-progress-type");if(r&&n&&a&&o){if(r.style.display="block",c&&(c.textContent=window.getTranslatedText("chartExport","processingDay")||"Processing day"),i){var l=window.getTranslatedText("chartExport","processingDay")||"Processing day: {current} / {total}";i.innerHTML=l.replace("{current}",'<span id="pdf-export-current">'.concat(t,"</span>")).replace("{total}",'<span id="pdf-export-total">'.concat(e,"</span>"))}else a.textContent=t,o.textContent=e;var u=Math.round(t/e*100);n.style.width="".concat(u,"%"),n.setAttribute("aria-valuenow",u)}}function H(t,e){var r=document.getElementById("pdf-export-month-progress-container"),n=document.getElementById("pdf-export-month-progress-bar"),a=document.getElementById("pdf-export-month-current"),o=document.getElementById("pdf-export-month-total"),i=document.getElementById("pdf-export-month-progress-text");if(r&&n&&a&&o){if(r.style.display="block",i){var c=window.getTranslatedText("chartExport","processingMonth")||"Processing month: {current} / {total}";i.innerHTML=c.replace("{current}",'<span id="pdf-export-month-current">'.concat(t,"</span>")).replace("{total}",'<span id="pdf-export-month-total">'.concat(e,"</span>"))}else a.textContent=t,o.textContent=e;var l=Math.round(t/e*100);n.style.width="".concat(l,"%"),n.setAttribute("aria-valuenow",l)}}var B=r(121);function R(){R=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var o=e&&e.prototype instanceof y?e:y,i=Object.create(o.prototype),c=new P(n||[]);return a(i,"_invoke",{value:L(t,r,c)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var h="suspendedStart",p="suspendedYield",f="executing",g="completed",m={};function y(){}function v(){}function w(){}var b={};u(b,i,(function(){return this}));var x=Object.getPrototypeOf,D=x&&x(x(O([])));D&&D!==r&&n.call(D,i)&&(b=D);var E=w.prototype=y.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(a,o,i,c){var l=d(t[a],t,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==X(s)&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(s).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}})}function L(e,r,n){var a=h;return function(o,i){if(a===f)throw Error("Generator is already running");if(a===g){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=T(c,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===h)throw a=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=f;var u=d(e,r,n);if("normal"===u.type){if(a=n.done?g:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=g,n.method="throw",n.arg=u.arg)}}}function T(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var o=d(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(X(e)+" is not iterable")}return v.prototype=w,a(E,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new S(s(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},k(E),u(E,l,"Generator"),u(E,i,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function U(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?U(Object(r),!0).forEach((function(e){q(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function q(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=X(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==X(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Z(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return K(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function J(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}function $(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){J(o,n,a,i,c,"next",t)}function c(t){J(o,n,a,i,c,"throw",t)}i(void 0)}))}}var Q={},tt={},et={};function rt(){return(rt=$(R().mark((function t(e,a,o){var s,h,f,g,m,y,v,w,b,x,D,E,k,S,L,T,j,C,P,O;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"undefined"!=typeof Chart){t.next=11;break}return t.next=4,Promise.resolve().then(r.bind(r,121));case 4:return s=t.sent,h=s.loadChartJs,t.next=8,h();case 8:if(t.sent){t.next=11;break}throw new Error("Failed to load Chart.js");case 11:if(f=document.getElementById(e)){t.next=15;break}return console.error("Container element ".concat(e," not found")),t.abrupt("return",null);case 15:if(null!=a){t.next=17;break}throw new Error("zaehlerid must be provided");case 17:if(g=Number(a),!isNaN(g)){t.next=21;break}throw console.error('Invalid zaehlerid provided: "'.concat(a,'" (').concat(X(a),")")),new Error("Invalid zaehlerid: ".concat(a));case 21:return console.log("Creating hourly chart for zaehlerid: ".concat(g,", date: ").concat(o)),t.next=24,(0,n.tZ)(a,o);case 24:if(m=t.sent){t.next=29;break}return console.log("No hourly data found for counter ".concat(a," on ").concat(o)),u(f),t.abrupt("return",null);case 29:return y=["00 - 01","01 - 02","02 - 03","03 - 04","04 - 05","05 - 06","06 - 07","07 - 08","08 - 09","09 - 10","10 - 11","11 - 12","12 - 13","13 - 14","14 - 15","15 - 16","16 - 17","17 - 18","18 - 19","19 - 20","20 - 21","21 - 22","22 - 23","23 - 24"],v=d(m),w=v.consumption,b=v.counterValues,x=i(w),D=window.formatNumber(x.total," kWh",window.getCurrentLanguage(),2),E=window.formatNumber(x.average," kWh",window.getCurrentLanguage(),2),k=window.getTranslatedText("chartStats","total"),S=window.getTranslatedText("charts","hour"),L="".concat(D," ").concat(k," - \xd8 ").concat(E," / ").concat(S),f.innerHTML='\n            <canvas id="'.concat(e,'-canvas"></canvas>\n        '),T=document.getElementById("".concat(e,"-canvas")),j={labels:y,datasets:[p("hourly",w,b)]},x.average>0&&(C=c(x,w.length),j.datasets.push(C.averageLine)),tt[e]=j,et[e]=x,P=T.getContext("2d"),O=new Chart(P,{type:"bar",data:j,options:Y(Y({},l()),{},{responsive:!0,plugins:Y(Y({},l().plugins),{},{title:{display:!0,position:"bottom",text:L}}),layout:{padding:{top:10,right:25,bottom:10,left:10}},animation:{duration:0},resizeDelay:0})}),Q[e]=O,O.zaehlerid=a,t.abrupt("return",O);case 50:return t.prev=50,t.t0=t.catch(0),console.error("Error creating hourly chart:",t.t0),t.abrupt("return",null);case 54:case"end":return t.stop()}}),t,null,[[0,50]])})))).apply(this,arguments)}function nt(t,e,r,n){return at.apply(this,arguments)}function at(){return at=$(R().mark((function t(e,a,o,s){var d,f,g,m,y,v,w,b,x,D,E,k,S,L,T,j,C,P,O,_,F,N,I,z,A,M,G,V,W,H=arguments;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=H.length>4&&void 0!==H[4]?H[4]:[],f=H.length>5&&void 0!==H[5]&&H[5],g=H.length>6&&void 0!==H[6]?H[6]:"",t.prev=3,"undefined"!=typeof Chart){t.next=14;break}return t.next=7,Promise.resolve().then(r.bind(r,121));case 7:return m=t.sent,y=m.loadChartJs,t.next=11,y();case 11:if(t.sent){t.next=14;break}throw new Error("Failed to load Chart.js");case 14:return t.next=16,(0,n.wi)(o,s,a);case 16:if(v=t.sent,w=document.getElementById(e)){t.next=20;break}return t.abrupt("return",null);case 20:if(0!==v.length){t.next=24;break}return console.log("No data found for counter ".concat(a," between ").concat(o," and ").concat(s)),u(w),t.abrupt("return",null);case 24:for(b={},x={},v.forEach((function(t){b[t.datum]=t.usage_day||0,x[t.datum]=t.val_end||0})),D=new Date(o),(E=new Date(s)).setHours(23,59,59);D<=E;)k=D.toISOString().split("T")[0],b[k]||(b[k]=0),x[k]||((S=new Date(D)).setDate(S.getDate()-1),L=S.toISOString().split("T")[0],x[k]=x[L]||0),D.setDate(D.getDate()+1);if(T=Object.keys(b).sort(),j=T.map((function(t){return b[t]})),C=T.map((function(t){return x[t]})),P=h(T),O=i(j),_=window.formatNumber(O.total," kWh",window.getCurrentLanguage(),2),F=window.formatNumber(O.average," kWh",window.getCurrentLanguage(),2),N=window.getTranslatedText("chartStats","total"),I=window.getTranslatedText("charts","day"),z="".concat(_," ").concat(N," - \xd8 ").concat(F," / ").concat(I),w.innerHTML='\n            <canvas id="'.concat(e,'-canvas"></canvas>\n        '),A=document.getElementById("".concat(e,"-canvas"))){t.next=45;break}return t.abrupt("return",null);case 45:return M={labels:P,datasets:[p("daily",j,C)],rawDates:T},O.average>0&&(G=c(O,j.length),M.datasets.push(G.averageLine)),M.rawDates=T,tt[e]=M,et[e]=O,V=A.getContext("2d"),(W=new Chart(V,{type:"bar",data:M,options:Y(Y({},l()),{},{responsive:!0,plugins:Y(Y({},l().plugins),{},{title:{display:!0,position:"bottom",text:z}}),onClick:f?function(t,e){if("click"===t.type&&e&&1===e.length){var r=e[0].index,n=T[r];d.includes(n)&&pt(a,g,n,d)}}:void 0,layout:{padding:{top:10,right:25,bottom:10,left:10}},animation:{duration:0},resizeDelay:0})})).zaehlerid=a,Q[e]=W,W.zaehlerid=a,t.abrupt("return",W);case 58:return t.prev=58,t.t0=t.catch(3),console.error("Error creating daily consumption chart:",t.t0),t.abrupt("return",null);case 62:case"end":return t.stop()}}),t,null,[[3,58]])}))),at.apply(this,arguments)}function ot(t,e,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(console.log("call to showHourly"),null!=t){var o=Number(t);if(isNaN(o))console.error('Invalid zaehlerid provided: "'.concat(t,'" (').concat(X(t),")"));else{if(console.log("Showing hourly data dialog for zaehlerid: ".concat(o)),!r){var i=new Date;r="".concat(i.getFullYear(),"-").concat(String(i.getMonth()+1).padStart(2,"0"),"-").concat(String(i.getDate()).padStart(2,"0"))}var c=null;if(a&&(c=document.getElementById(a))){var l=bootstrap.Modal.getInstance(c);l&&l.hide()}var u="hourly-data-modal-".concat(t),d="hourly-data-chart-".concat(t),h=document.getElementById(u);h&&h.remove();var p=new Date(r).toLocaleDateString(window.getCurrentLanguage()),f=s({modalId:u,chartId:d,title:window.getTranslatedText("charts","hourlyData").replace("{0}","".concat(e," (").concat(p,")")),isHourly:!0,hasParent:!!a});if(document.body.insertAdjacentHTML("beforeend",f),h=document.getElementById(u),function(t,e,r){rt.apply(this,arguments)}(d,t,r),a&&c){var g=document.getElementById("back-to-daily-btn");g&&g.addEventListener("click",(function(){var t=h.querySelector(".btn-close");t&&t.click()}))}new bootstrap.Modal(h).show(),h.addEventListener("hidden.bs.modal",(function(){if(a){var t=document.getElementById(a);if(t)new bootstrap.Modal(t).show()}}))}}else console.error("zaehlerid must be provided")}function it(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];console.log("call to showdaily "+(new Date).toISOString()+" "+t+" description: "+e);var i=new Date;if(n||(n="".concat(i.getFullYear(),"-").concat(String(i.getMonth()+1).padStart(2,"0"),"-").concat(String(i.getDate()).padStart(2,"0"))),!r){var c=new Date(i);c.setDate(i.getDate()-6),r="".concat(c.getFullYear(),"-").concat(String(c.getMonth()+1).padStart(2,"0"),"-").concat(String(c.getDate()).padStart(2,"0"))}var l="daily-consumption-modal-".concat(t),u="daily-consumption-chart-".concat(t),d=document.getElementById(l);d&&d.remove();var h=s({modalId:l,chartId:u,title:window.getTranslatedText("charts","dailyData").replace("{0}",e),isHourly:!1,hasParent:!1,startDate:r,endDate:n,showClickInstructions:o});document.body.insertAdjacentHTML("beforeend",h),d=document.getElementById(l),nt(u,t,r,n,a,o,e);var p=window.safeParseDate(r),f=window.safeParseDate(n),g=Z(a).sort(),m=g.length>0?g[0]:null,y=(0,B.initDatePicker)("".concat(l,"-start-datepicker"),p,a,m,null),v=(0,B.initDatePicker)("".concat(l,"-end-datepicker"),f,a,m,null);[document.getElementById("".concat(l,"-start-datepicker")),document.getElementById("".concat(l,"-end-datepicker"))].forEach((function(t){if(t)if(t.classList.add("force-visible"),t.querySelector(".tempus-dominus-widget"))console.warn("Found tempus dominus widget in container: ".concat(t.id));else{console.warn("No tempus dominus widget in container: ".concat(t.id));var e=t.id.includes("start")?p:f,r=(0,B.initDatePicker)(t.id,e,a,m,null);console.warn("Re-initialization attempt result: ".concat(r?"success":"failed"))}}));var w=new Set(a);(0,B.highlightAvailableDates)("".concat(l,"-start-datepicker"),w),(0,B.highlightAvailableDates)("".concat(l,"-end-datepicker"),w);var b=null,x=null,D=function(){var r=document.getElementById("".concat(l,"-start-date")).value,n=document.getElementById("".concat(l,"-end-date")).value;r&&n?r!==b||n!==x?(b=r,x=n,nt(u,t,r,n,a,o,e)):console.log("Dates have not changed, skipping chart update"):console.warn("Start or end date is missing")};y.subscribe(tempusDominus.Namespace.events.update,(function(t){(0,B.highlightAvailableDates)("".concat(l,"-start-datepicker"),w)})),y.subscribe(tempusDominus.Namespace.events.change,(function(t){try{var e=(0,B.formatDateFromPicker)(t);if(e)document.getElementById("".concat(l,"-start-date")).value=e,e>document.getElementById("".concat(l,"-end-date")).value&&(document.getElementById("".concat(l,"-end-date")).value=e,t.date&&v.dates.setValue(t.date)),D()}catch(r){console.error("Error in start date change handler:",r)}})),v.subscribe(tempusDominus.Namespace.events.update,(function(t){(0,B.highlightAvailableDates)("".concat(l,"-end-datepicker"),w)})),v.subscribe(tempusDominus.Namespace.events.change,(function(t){try{var e=(0,B.formatDateFromPicker)(t);if(e)document.getElementById("".concat(l,"-end-date")).value=e,e<document.getElementById("".concat(l,"-start-date")).value&&(document.getElementById("".concat(l,"-start-date")).value=e,t.date&&y.dates.setValue(t.date)),D()}catch(r){console.error("Error in end date change handler:",r)}})),new bootstrap.Modal(d).show()}function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function lt(){lt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var o=e&&e.prototype instanceof y?e:y,i=Object.create(o.prototype),c=new P(n||[]);return a(i,"_invoke",{value:L(t,r,c)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var h="suspendedStart",p="suspendedYield",f="executing",g="completed",m={};function y(){}function v(){}function w(){}var b={};u(b,i,(function(){return this}));var x=Object.getPrototypeOf,D=x&&x(x(O([])));D&&D!==r&&n.call(D,i)&&(b=D);var E=w.prototype=y.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(a,o,i,c){var l=d(t[a],t,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==ct(s)&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(s).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}})}function L(e,r,n){var a=h;return function(o,i){if(a===f)throw Error("Generator is already running");if(a===g){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=T(c,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===h)throw a=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=f;var u=d(e,r,n);if("normal"===u.type){if(a=n.done?g:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=g,n.method="throw",n.arg=u.arg)}}}function T(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var o=d(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(ct(e)+" is not iterable")}return v.prototype=w,a(E,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new S(s(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},k(E),u(E,l,"Generator"),u(E,i,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function ut(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}document.addEventListener("click",(function(t){!function(t,e,r,n){var a,o,i=t.target.closest("[data-export-action]");if(i){t.preventDefault();var c=i.getAttribute("data-chart-id"),l="true"===i.getAttribute("data-include-daily"),u=i.getAttribute("data-export-action"),s=e[c],d=r[c],h=n[c];if(s){var p=c.includes("hourly")?"hourly":"daily",f="kWh";switch(u){case"excel":d&&I(d,h,p,f,l,s);break;case"excel-daily":d&&I(d,h,p,f,!0,s);break;case"pdf":S(s,(null===(a=s.options.plugins.title)||void 0===a?void 0:a.text)||"Chart",h,p,f,l);break;case"pdf-daily":S(s,(null===(o=s.options.plugins.title)||void 0===o?void 0:o.text)||"Chart",h,p,f,!0)}}}}(t,Q,tt,et)}));var st=!1;function dt(){st||(st=!0,document.addEventListener("click",(function(t){var e=t.target.closest('a[data-translation-key="actions.history"]');if(e){t.preventDefault();var r=e.closest('tr[id^="chn"]'),n=e.closest('div[id^="mobile-chn"]'),a=null;if(r?a=r.id.replace("chn",""):n&&(a=n.id.replace("mobile-chn","")),a){var o=window.getChannelById(a);if(o)!function(t,e){ht.apply(this,arguments)}(a,window.decodeChannel(o).beschreibung);else console.error("Channel ".concat(a," not found"))}else console.error("Could not find channel ID for history link")}})))}function ht(){var t;return t=lt().mark((function t(e,a){var o,i,c,l,u,s,d,h,p,f,g;return lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o="daily-consumption-modal-".concat(e),!(i=document.getElementById(o))){t.next=7;break}return console.log("Modal for channel ".concat(e," already exists, focusing instead of recreating")),(c=bootstrap.Modal.getInstance(i))?c.show():new bootstrap.Modal(i).show(),t.abrupt("return");case 7:if("undefined"!=typeof Chart){t.next=18;break}return t.next=10,Promise.resolve().then(r.bind(r,121));case 10:return l=t.sent,u=l.loadChartJs,t.next=14,u();case 14:if(t.sent){t.next=18;break}return console.error("Failed to load Chart.js, cannot display chart"),t.abrupt("return");case 18:if(s=Number(e),!isNaN(s)){t.next=22;break}return console.error('Invalid channelId: "'.concat(e,'"')),t.abrupt("return");case 22:return d=new Date,h="".concat(d.getFullYear(),"-").concat(String(d.getMonth()+1).padStart(2,"0"),"-").concat(String(d.getDate()).padStart(2,"0")),(p=new Date(d)).setDate(d.getDate()-6),f="".concat(p.getFullYear(),"-").concat(String(p.getMonth()+1).padStart(2,"0"),"-").concat(String(p.getDate()).padStart(2,"0")),g=[],t.prev=28,t.next=31,(0,n.kC)(s);case 31:g=t.sent,console.log("Available dates for clickable days:",g),t.next=38;break;case 35:t.prev=35,t.t0=t.catch(28),console.warn("Could not fetch available dates:",t.t0);case 38:it(s,a,f,h,g,!0);case 39:case"end":return t.stop()}}),t,null,[[28,35]])})),ht=function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){ut(o,n,a,i,c,"next",t)}function c(t){ut(o,n,a,i,c,"throw",t)}i(void 0)}))},ht.apply(this,arguments)}function pt(t,e,r,n){console.log("Day clicked in weekly chart: channelId=".concat(t,", date=").concat(r)),ot(t,e,r,n,"daily-consumption-modal-".concat(t))}},559:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Counter: {0}",backToDailyView:"Back to Daily Overview",clickDayInstructions:"Click on a day to view hourly data",hourlyConsumption:"Hourly Consumption (kWh)",dailyConsumption:"Daily Consumption (kWh)",hourlyData:"Hourly Data: {0}",dailyData:"Daily Consumption: {0}",date:"Date:",startDate:"Start Date",endDate:"End Date",consumption:"Consumption: {0}",noDataAvailable:"No data available for this date range.",close:"Close",day:"Day",hour:"Hour",history:{title:"History: {0}",hourlyData:"Hourly Consumption (Today)",dailyData:"Daily Consumption (Last 7 Days)"}},chartStats:{title:"Statistics",total:"Total Consumption",average:"Average",median:"Median",statistics:"Statistics",averageLine:"Average",medianLine:"Median"},chartExport:{abortExport:"Abort",processingMonth:"Processing month: {current} / {total}",processingDay:"Processing day: {current} / {total}",aborting:"Aborting...",exportCancelled:"PDF export was cancelled",hourlyConsumptionData:"Hourly Consumption Data",dailyConsumptionData:"Daily Consumption Data",exportDropdown:"Export",exportingPDF:"Generating PDF...",exportPDFWithDaily:"PDF with hourly values",exportExcelWithDaily:"Excel with hourly values",overviewSheet:"Overview",detailsSheet:"Daily Details",exportExcel:"Export Excel",exportPDF:"Export PDF",hour:"Hour",date:"Date",consumption:"Consumption",counter:"Counter",dataSheet:"Consumption Data",errorExporting:"Error exporting data"},chartPDF:{pageNumbers:"Page {current} of {total}"}}},750:(t,e,r)=>{var n={"./charts-lang-de-DE.js":456,"./charts-lang-en-US.js":559,"./charts-lang-es-ES.js":290,"./charts-lang-fr-FR.js":178,"./charts-lang-hr-HR.js":778,"./charts-lang-it-IT.js":240,"./charts-lang-nl-NL.js":846,"./charts-lang-sl-SI.js":359};function a(t){return Promise.resolve().then((()=>{if(!r.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r(n[t])}))}a.keys=()=>Object.keys(n),a.id=750,t.exports=a},778:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Brojilo: {0}",backToDailyView:"Natrag na dnevni pregled",clickDayInstructions:"Kliknite na dan za pregled satnih podataka",hourlyConsumption:"Satna Potro\u0161nja (kWh)",dailyConsumption:"Dnevna Potro\u0161nja (kWh)",hourlyData:"Satni Podaci: {0}",dailyData:"Dnevna Potro\u0161nja: {0}",date:"Datum:",startDate:"Po\u010detni Datum",endDate:"Zavr\u0161ni Datum",consumption:"Potro\u0161nja: {0}",noDataAvailable:"Nema dostupnih podataka za ovo razdoblje.",close:"Zatvori",day:"Dan",hour:"Sat",history:{title:"Povijest: {0}",hourlyData:"Satna Potro\u0161nja (Danas)",dailyData:"Dnevna Potro\u0161nja (Zadnjih 7 Dana)"}},chartStats:{title:"Statistika",total:"Ukupna Potro\u0161nja",average:"Prosjek",median:"Medijan",statistics:"Statistika",averageLine:"Prosjek",medianLine:"Medijan"},chartExport:{abortExport:"Odustani",processingMonth:"Obrada mjeseca: {current} / {total}",processingDay:"Obrada dana: {current} / {total}",aborting:"Odustajanje...",exportCancelled:"Izvoz PDF-a je otkazan",hourlyConsumptionData:"Podaci o Satnoj Potro\u0161nji",dailyConsumptionData:"Podaci o Dnevnoj Potro\u0161nji",exportDropdown:"Izvoz",exportingPDF:"Stvaranje PDF-a...",exportPDFWithDaily:"PDF sa satnim vrijednostima",exportExcelWithDaily:"Excel sa satnim vrijednostima",overviewSheet:"Pregled",detailsSheet:"Dnevni Detalji",exportExcel:"Izvoz Excel",exportPDF:"Izvoz PDF",hour:"Sat",date:"Datum",consumption:"Potro\u0161nja",counter:"Brojilo",dataSheet:"Podaci o Potro\u0161nji",errorExporting:"Gre\u0161ka pri izvozu podataka"},chartPDF:{pageNumbers:"Stranica {current} od {total}"}}},846:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n={charts:{counterValue:"Teller: {0}",backToDailyView:"Terug naar dagelijks overzicht",clickDayInstructions:"Klik op een dag om uurgegevens te bekijken",hourlyConsumption:"Uurlijks Verbruik (kWh)",dailyConsumption:"Dagelijks Verbruik (kWh)",hourlyData:"Uurlijkse Gegevens: {0}",dailyData:"Dagelijks Verbruik: {0}",date:"Datum:",startDate:"Startdatum",endDate:"Einddatum",consumption:"Verbruik: {0}",noDataAvailable:"Geen gegevens beschikbaar voor deze periode.",close:"Sluiten",day:"Dag",hour:"Uur",history:{title:"Geschiedenis: {0}",hourlyData:"Uurlijks Verbruik (Vandaag)",dailyData:"Dagelijks Verbruik (Laatste 7 Dagen)"}},chartStats:{title:"Statistieken",total:"Totaal Verbruik",average:"Gemiddelde",median:"Mediaan",statistics:"Statistieken",averageLine:"Gemiddelde",medianLine:"Mediaan"},chartExport:{abortExport:"Afbreken",processingMonth:"Maand verwerken: {current} / {total}",processingDay:"Dag verwerken: {current} / {total}",aborting:"Afbreken...",exportCancelled:"PDF-export is geannuleerd",hourlyConsumptionData:"Uurlijkse Verbruiksgegevens",dailyConsumptionData:"Dagelijkse Verbruiksgegevens",exportDropdown:"Exporteren",exportingPDF:"PDF wordt gegenereerd...",exportPDFWithDaily:"PDF met uurwaarden",exportExcelWithDaily:"Excel met uurwaarden",overviewSheet:"Overzicht",detailsSheet:"Dagelijkse Details",exportExcel:"Exporteren naar Excel",exportPDF:"Exporteren als PDF",hour:"Uur",date:"Datum",consumption:"Verbruik",counter:"Tellerstand",dataSheet:"Verbruiksgegevens",errorExporting:"Fout bij exporteren gegevens"},chartPDF:{pageNumbers:"Pagina {current} van {total}"}}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.e=()=>Promise.resolve(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(t=n(405)).keys().forEach(t),(()=>{var t=n(121),e=n(75),r=n(515);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==a(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(){l=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var a=e&&e.prototype instanceof w?e:w,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:j(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function w(){}function b(){}function x(){}var D={};d(D,c,(function(){return this}));var E=Object.getPrototypeOf,k=E&&E(E(F([])));k&&k!==r&&n.call(k,c)&&(D=k);var S=x.prototype=w.prototype=Object.create(D);function L(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,c,l){var u=p(t[o],t,i);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==a(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,c,l)}),(function(t){r("throw",t,c,l)})):e.resolve(d).then((function(t){s.value=t,c(s)}),(function(t){return r("throw",t,c,l)}))}l(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return i=i?i.then(a,a):a()}})}function j(e,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=C(c,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=p(e,r,n);if("normal"===u.type){if(a=n.done?y:g,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=y,n.method="throw",n.arg=u.arg)}}}function C(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=p(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(S,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=d(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,d(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(T.prototype),d(T.prototype,u,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new T(h(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),d(S,s,"Generator"),d(S,c,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function u(t,e,r,n,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,a)}function s(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){u(o,n,a,i,c,"next",t)}function c(t){u(o,n,a,i,c,"throw",t)}i(void 0)}))}}console.log("Module body executing, script URL:","file:///home/runner/work/zfa.io_v1/zfa.io_v1/modules/charts/ctools-charts.js"),void 0===window._chartsModuleInitialized&&(window._chartsModuleInitialized=!1);var d,h=new Set,p={initialized:!1,initializing:!1,error:null};function f(){return g.apply(this,arguments)}function g(){return g=s(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v();case 3:return window.translations=window.translations||{},window.translations.charts=window.translations.charts||{},window.translations.chartStats=window.translations.chartStats||{},window.translations.chartExport=window.translations.chartExport||{},window.translations.chartPDF=window.translations.chartPDF||{},t.next=10,m(window.getCurrentLanguage());case 10:return document.addEventListener("languageChanged",function(){var t=s(l().mark((function t(e){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.detail||!e.detail.newLanguage){t.next=3;break}return t.next=3,m(e.detail.newLanguage);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),x(),console.log("Chart statistics and export features initialized"),t.abrupt("return",!0);case 16:return t.prev=16,t.t0=t.catch(0),console.error("Error initializing chart extensions:",t.t0),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),t,null,[[0,16]])}))),g.apply(this,arguments)}function m(t){return y.apply(this,arguments)}function y(){return(y=s(l().mark((function t(e){var r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e||"en-US",!h.has(e)){t.next=3;break}return t.abrupt("return",!0);case 3:return t.prev=3,t.next=6,n(750)("./charts-lang-".concat(e,".js"));case 6:if(!(r=t.sent).default){t.next=17;break}return r.default.charts&&(window.translations.charts=i(i({},window.translations.charts),r.default.charts)),r.default.chartStats&&(window.translations.chartStats=i(i({},window.translations.chartStats),r.default.chartStats)),r.default.chartExport&&(window.translations.chartExport=i(i({},window.translations.chartExport),r.default.chartExport)),r.default.chartPDF&&(window.translations.chartPDF=i(i({},window.translations.chartPDF),r.default.chartPDF)),h.add(e),console.log("Chart language ".concat(e," loaded successfully")),t.abrupt("return",!0);case 17:throw new Error("Invalid language module format for ".concat(e));case 18:t.next=27;break;case 20:if(t.prev=20,t.t0=t.catch(3),console.error("Failed to load chart language ".concat(e,":"),t.t0),"en-US"===e){t.next=26;break}return console.log("Attempting to load fallback language (en-US)"),t.abrupt("return",m("en-US"));case 26:return t.abrupt("return",!1);case 27:case"end":return t.stop()}}),t,null,[[3,20]])})))).apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){return(w=s(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Loading chart export libraries directly..."),t.next=4,b("https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js");case 4:return t.next=6,b("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js");case 6:return t.next=8,b("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js");case 8:return console.log("Chart export libraries loaded successfully"),t.abrupt("return",!0);case 12:return t.prev=12,t.t0=t.catch(0),console.error("Error loading chart export libraries:",t.t0),t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}function b(t){return new Promise((function(e,r){var n=document.createElement("script");n.src=t,n.async=!0,n.onload=function(){return e()},n.onerror=function(t){return r(t)},document.head.appendChild(n)}))}function x(){var t=document.createElement("style");t.textContent="\n    /* Chart statistics panel */\n    .chart-stats-panel {\n        display: flex;\n        justify-content: space-around;\n        background-color: #f8f9fa;\n        border-radius: 4px;\n        padding: 8px 16px;\n        margin: 15px 0;\n        border: 1px solid #dee2e6;\n    }\n    \n    .chart-stats-panel .stat-item {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 5px 10px;\n    }\n    \n    .chart-stats-panel .stat-label {\n        font-size: 0.85rem;\n        color: #6c757d;\n        margin-bottom: 3px;\n    }\n    \n    .chart-stats-panel .stat-value {\n        font-size: 1.1rem;\n        font-weight: 500;\n        color: #0076A8; /* CTOOLS blue */\n    }\n    \n    /* Export buttons container */\n    .chart-export-buttons {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-bottom: 15px;\n    }\n    \n    .chart-export-buttons .btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        white-space: nowrap;\n    }\n    \n    .chart-export-buttons .btn i {\n        margin-right: 5px;\n    }\n    \n    /* Responsive adjustments */\n    @media (max-width: 768px) {\n        .chart-stats-panel {\n            flex-direction: column;\n            align-items: center;\n            padding: 8px;\n        }\n        \n        .chart-stats-panel .stat-item {\n            margin-bottom: 5px;\n            width: 100%;\n            flex-direction: row;\n            justify-content: space-between;\n        }\n        \n        .chart-stats-panel .stat-label {\n            margin-right: 10px;\n            margin-bottom: 0;\n        }\n        \n        /* Adjust export buttons for mobile */\n        .chart-export-buttons {\n            justify-content: center;\n        }\n        \n        .chart-export-buttons .btn {\n            padding: 4px 8px;\n            font-size: 0.85rem;\n        }\n    }\n    ",document.head.appendChild(t)}(d=s(l().mark((function n(){var a;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!window.__CTOOLSchartsModuleInitialized){n.next=2;break}return n.abrupt("return");case 2:return window.__CTOOLSchartsModuleInitialized=!0,p.initializing=!0,n.prev=4,n.next=7,(0,r.C)();case 7:return n.next=9,(0,e.Qm)();case 9:return n.next=11,(0,t.initializeChartResources)();case 11:return n.next=13,f();case 13:if(a=n.sent,p.initialized=a,p.initializing=!1,!a){n.next=21;break}console.log("Chart module: Self-initialization complete"),document.dispatchEvent(new CustomEvent("moduleReady",{detail:{module:"charts",success:!0}})),n.next=22;break;case 21:throw new Error("Chart initialization failed");case 22:n.next=30;break;case 24:n.prev=24,n.t0=n.catch(4),p.error=n.t0,p.initializing=!1,console.error("Chart module: Initialization failed",n.t0),document.dispatchEvent(new CustomEvent("moduleReady",{detail:{module:"charts",success:!1,error:n.t0.message}}));case 30:case"end":return n.stop()}}),n,null,[[4,24]])}))),function(){return d.apply(this,arguments)})()})();